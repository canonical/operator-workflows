name: Workflow test

on:
  pull_request:

jobs:
  metadata_yaml:
    uses: ./.github/workflows/test.yaml
    with:
      working-directory: 'tests/workflows/test/metadata_yaml/'
    secrets: inherit
  no_metadata_yaml:
    uses: ./.github/workflows/test.yaml
    with:
      working-directory: 'tests/workflows/test/no_metadata_yaml/'
    secrets: inherit
  check:
    runs-on: ubuntu-latest
    needs:
      - metadata_yaml
      - no_metadata_yaml
    steps:
      - run: |
          [ '${{ needs.metadata_yaml.outputs.metadata-lint-outcome }}' = 'success' ] || (echo metadata lint failed && false)
          [ '${{ needs.metadata_yaml.outputs.docker-lint-outcome }}' = 'success' ] || (echo docker lint failed && false)
          [ '${{ needs.no_metadata_yaml.outputs.metadata-lint-outcome }}' = 'skip' ] || (echo metadata lint failed && false)
          [ '${{ needs.no_metadata_yaml.outputs.docker-lint-outcome }}' = 'success' ] || (echo docker lint failed && false)
